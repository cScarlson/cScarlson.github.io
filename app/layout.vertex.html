
<script type="module">
    import V, {} from '/vertices/core.js';
    
    const { log } = console;
    V('layout', 'sandbox', function Layout($) {
        const { firstElementChild: script } = this;
        const { nextElementSibling: layout } = script;
        const { firstElementChild: header } = layout;
        const { nextElementSibling: menu } = header;
        const { nextElementSibling: main } = menu;
        const keyboardActions = new Set();
        const keyboardHandlers = {
            'Control+f': handleSearch,
        };
        
        function handleMenuStateChange(e) {
            if ( !e.target.matches('.menu.button.main .button.control') ) return;
            const { target } = e;
            const { checked } = target;
            const operation = { 'true': 'add', 'false': 'remove' }[ checked ];
            
            header.classList[operation]('active');
            main.classList[operation]('inactive');
            log(`@layout#handleMenuStateChange`, checked, main);
        }
        
        function handleNavigation(e) {
            if ( !e.target.matches('a.link.view') ) return;
            const { target } = e;
            const { href } = target;
            const { hash } = new URL(href);
            const toggle = header.querySelector('menu .menu.button.main .button.control');
            
            window.location.hash = '/';
            toggle.checked = false;
            toggle.dispatchEvent( new CustomEvent('change') );
            setTimeout( x => window.location.hash = hash, 1000 * 1.5 );
            e.preventDefault();
        }
        
        function handleKeydown(e) {
            const { type, key } = e;
            keyboardActions.add(key);
            if (key === 'f') e.preventDefault();  // last key for Ctrl+f
        }
        
        function handleKeyup(e) {
            const keys = [ ...keyboardActions ];
            const combo = keys.join('+');
            const handle = keyboardHandlers[combo];
            
            if (handle) handle.call(this, e);
            keyboardActions.clear();
        }
        
        function handleSearch(e) {
            $.publish('USER:SEARCH:INVOKED');
        }
        
        function handleEvent(e) {
            const { type, target } = e;
            const handler = {
                'change': handleMenuStateChange,
                'click': handleNavigation,
                'keydown': handleKeydown,
                'keyup': handleKeyup,
            }[ type ];
            
            if (handler) handler.call(this, e);
        }
        
        this.handleEvent = handleEvent;
        this.on('change', this, true);
        this.on('click', this, true);
        document.addEventListener('keydown', this, true);
        document.addEventListener('keyup', this, true);
        this.fire('vertex:ready', this);
        
        return this;
    });
    
</script>

<layout class="layout container">
    <header class="layout header"></header>
    <menu:links class="layout menu"></menu:links>
    <main class="layout content">
        <home></home>
        <resume></resume>
        <cv></cv>
        <consulting></consulting>
        <contact></contact>
        <about></about>
        <blog></blog>
        <vertices></vertices>
    </main>
    <footer id="/footer" class="layout footer">
        <slot name="footer"></slot>
    </footer>
    <top></top>
</layout>

<style>
    .layout.container {
        display: block;
        position: relative;
        background:
            linear-gradient(transparent, lightsalmon),
            radial-gradient(circle at 40% 100px, #f09819 80px, transparent 270px),
            radial-gradient(circle at 36% 250px, #1845ad 80px, transparent 270px),
            radial-gradient(circle at 64% 180px, #ff512f 80px, transparent 270px)
            ;
        background-size: 100%;
        background-attachment: fixed;
        background-repeat: no-repeat;
        background-origin: border-box;
        height: 100%;
        border-width: 0px;
    }
    
    .layout.container .layout.header {
        position: sticky;
        top: 0;
        margin: 0;
        padding: 0;
        background-color: rgba(0, 0, 0, 0.7);
        box-shadow: 0px 0px 6px 2px black;
        z-index: 9999;
    }
    
    .layout.container .layout.menu {
        display: block;
        width: 100%;
        height: calc(100vh - 64px);
        position: fixed;
        top: 64px;
        left: 0;
        transform: scale(0);
        transform-origin: top;
        transition: transform 1s 0.25s ease-in-out;
        z-index: 999;
        background-color: rgba(0, 0, 0, 0.7);
        background-clip: padding-box;
        border-top-style: double;
        border-top-width: 12px;
        border-top-color: rgba(255, 255, 255, 0.7);
    }
    
    .layout.container .layout.header.active ~ .layout.menu {
        transform: scale(1);
    }
    
    .layout.container .layout.content {
        height: 100%;
        margin: 8px 5%;
        padding: 16px;
        border: solid 0px transparent;
        border-radius: 30px;
        transform-origin: top;
        transition: transform 1s 0.25s ease-in-out, border 1s 0.25s ease-in-out, height 0s 1.25s ease-in-out;
        overflow: hidden;
    }
    .layout.container .layout.content.inactive {
        transform: scale(0.25) translateY(25vh);
        transition: transform 1s 0.25s ease-in-out, border 1s 0.25s ease-in-out;
        border: solid 16px white;
    }
    .layout.container .layout.content .page {
        background-color: rgba(255, 255, 255, 0.3);
        padding: 4px 8px;
        margin: 8px 0;
        border-radius: 4px;
    }
    
    .layout.container .layout.footer {
        min-height: 100vh;
        background-color: rgba(123, 87, 99, 0.5);
    }
</style>
