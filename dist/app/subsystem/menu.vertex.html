
<script type="module" defer>
    import V, { LIFECYCLE_EVENTS } from './vertices/core.js';
    
    const { log } = console;
    const { oninit, onmount, onrender } = LIFECYCLE_EVENTS;
    
    V('menu')(function MenuComponent({ self, module, metadata }) {
        
        function init() {
            const menu = module.querySelector('.app.menu');
            const toggle = menu.querySelector('.menu.control.toggle');
            
            this.menu = menu;
            this.toggle = toggle;
            toggle.addEventListener('change', this, false);
            window.addEventListener('hashchange', this, false);
            log(`@menu`, this.menutest);
        }
        
        function handleEvent(e) {
            const { type } = e;
            const handler = {
                'change': handleToggle,
                'hashchange': handleHashchange,
            }[ type ];
            
            if (handler) handler.call(this, e);
        }
        
        function handleToggle(e) {
            const { menu } = this;
            const { target } = e;
            const { checked } = target;
            const detail = { opened: checked };
            const event = new CustomEvent('menu:state', { detail });
            
            console.log(`@TOGGLE`, checked);
            menu.dispatchEvent(event);
        }
        
        function handleHashchange(e) {
            const { menu, toggle } = this;
            const detail = { opened: false };
            const event = new CustomEvent('menu:state', { detail });
            
            toggle.checked = detail.opened;
            menu.dispatchEvent(event);
        }
        
        // export precepts
        this.menu = null;
        this.toggle = null;
        this[onmount] = init;
        this['watch:menutest'] = (...a) => log(...a);
        this.handleEvent = handleEvent;
        
        return this;
    });
</script>

<div --view class="app menu">
    <input class="menu control toggle" type="checkbox" />
    <span class="menu icon">&#8801;</span>
    <slot class="menu canvas" name="menu"></slot>
</div>

<style>
    :root {
        --menu-height: 48px;
    }
    .app.menu {
        /* border: solid 1px tomato; */
        width: 100%;
        height: var(--menu-height);
        background-color: rgba(0, 0, 0, 0.75);
        box-shadow: 0px 0px 8px 2px black;
    }
    .app.menu .menu.control.toggle {
        outline: solid 1px tomato;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        width: var(--menu-height);
        height: var(--menu-height);
        margin: 0;
        padding: 0;
        opacity: 0;
        z-index: 1;
        cursor: pointer;
    }
    .app.menu .menu.icon {
        display: flex;
        justify-content: center;
        align-items: center;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        width: var(--menu-height);
        height: var(--menu-height);
        margin: 0;
        padding: 0;
        font-size: var(--menu-height);
        line-height: var(--menu-height);
        cursor: pointer;
        color: white;
    }
    .app.menu .menu.canvas {
        position: absolute;
        top: var(--menu-height);
        display: block;
        width: 100%;
        height: calc(100vh - var(--menu-height));
        transform: scale(0);
        transform-origin: center;
        transition: transform 500ms;
        background-color: rgba(0, 0, 0, 0.75);
        background-clip: padding-box;
        border-top: double 10px rgba(255, 255, 255, 0.5);
    }
    .app.menu .menu.control.toggle:checked ~ .menu.icon {
        color: #f09819;
    }
    .app.menu .menu.control.toggle:checked ~ .menu.canvas {
        transform: scale(1);
        transition: transform 500ms;
    }
    .app.menu .menu.canvas a {
        color: white;
        text-decoration: none;
    }
</style>
